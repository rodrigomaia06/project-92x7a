<!DOCTYPE html>
<html lang="pt">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Matilde Batalha | Psicologia Clínica
  </title>
  <meta content="Psicologia Clínica, Psicoterapia, Terapia Familiar e de Casal" name="description"/>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Cardo:ital@0;1&amp;family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <link href="styles.css" rel="stylesheet"/>
 </head>
 <body data-lang="pt">
  <a class="skip-link" href="#main-content">
   Saltar para o conteúdo
  </a>
  <div class="site">
   <div data-current-lang="pt" data-en-url="en/index.html" data-include="header" data-pt-url="pt/index.html">
   </div>
   <!-- ====== MAIN ====== -->
   <main id="main-content">
    <section class="hero">
     <div class="container hero-inner">
      <div class="hero-copy">
       <h1>
        Sobre mim…
       </h1>
       <p>
        Olá, o meu nome é Matilde Batalha. Sou psicóloga e psicoterapeuta. Este é o meu espaço profissional onde partilho a forma como integro diferentes abordagens terapêuticas.
       </p>
       <p>
        Acredito na singularidade de cada pessoa — não existe uma intervenção única que sirva todas as histórias. Continuo a formar-me para poder acompanhar-te com rigor, respeito e humanidade.
       </p>
       <p>
        Neste site encontras artigos, recursos e reflexões sobre saúde mental, relações humanas, natureza e o nosso caminho interior.
       </p>
      </div>
      <figure class="hero-portrait">
       <img alt="Retrato de Matilde Batalha" height="400" loading="lazy" src="static/site/hero.jpg" width="346"/>
      </figure>
     </div>
    </section>
    <section class="articles">
     <div class="container">
      <h2>
       Artigos para ler e comentar – “Da discussão nasce a luz”
      </h2>
      <div class="post-list" data-state="loading">
       <p class="loading-message">
        A carregar artigos…
       </p>
      </div>
      <nav aria-label="Paginação" class="pagination">
       <button aria-label="Página anterior" class="pagination-button prev" type="button">
        ←
       </button>
       <div class="pagination-numbers">
       </div>
       <button aria-label="Próxima página" class="pagination-button next" type="button">
        →
       </button>
      </nav>
     </div>
    </section>
   </main>
   <div data-include="footer">
   </div>
  </div>
  <!-- ====== SCRIPTS ====== -->
  <script src="scripts/include.js" type="module">
  </script>
  <script>
   window.addEventListener('DOMContentLoaded', () => {
    const monthFormatter = new Intl.DateTimeFormat('pt-PT', { day: 'numeric', month: 'short', year: 'numeric' });
    const POSTS_PER_PAGE = 8;
    let currentPage = 1;
    let postsData = [];

    function formatDate(iso) {
      if (!iso) return '';
      const date = new Date(iso);
      return Number.isNaN(date.getTime()) ? '' : monthFormatter.format(date);
    }

    function createPostArticle(post) {
      const article = document.createElement('article');
      article.className = 'post';

      const content = document.createElement('div');
      content.className = 'post-content';

      const title = document.createElement('h3');
      const link = document.createElement('a');
      link.href = `post.html?post=${encodeURIComponent(post.path)}`;
      link.textContent = post.title;
      title.append(link);

      const excerpt = document.createElement('p');
      excerpt.className = 'post-excerpt';
      excerpt.textContent = post.excerpt || '';

      content.append(title, excerpt);

      const meta = document.createElement('div');
      meta.className = 'post-meta';

      if (post.date) {
        const time = document.createElement('time');
        time.dateTime = post.date;
        time.textContent = formatDate(post.date);
        meta.append(time);
      }

      const author = document.createElement('span');
      author.className = 'post-author';
      author.innerHTML = 'por <span class="author-name">Matilde Batalha</span>';
      meta.append(author);

      if (Array.isArray(post.categories) && post.categories.length) {
        const categories = document.createElement('span');
        categories.className = 'post-categories';
        const prefix = document.createElement('span');
        prefix.className = 'category-prefix';
        prefix.textContent = 'em ';
        categories.append(prefix);
        post.categories.forEach((category, index) => {
          const catEl = document.createElement('span');
          catEl.className = 'category';
          catEl.textContent = category;
          categories.append(catEl);
          if (index < post.categories.length - 1) {
            categories.append(document.createTextNode(', '));
          }
        });
        meta.append(categories);
      }

      article.append(content, meta);
      return article;
    }

    function renderPosts() {
      const listEl = document.querySelector('.post-list');
      if (!listEl) return;
      listEl.innerHTML = '';
      const start = (currentPage - 1) * POSTS_PER_PAGE;
      const pagePosts = postsData.slice(start, start + POSTS_PER_PAGE);
      pagePosts.forEach(post => listEl.append(createPostArticle(post)));
    }

    function renderPagination() {
      const pagination = document.querySelector('.pagination');
      if (!pagination) return;
      const prevButton = pagination.querySelector('.prev');
      const nextButton = pagination.querySelector('.next');
      const numbersContainer = pagination.querySelector('.pagination-numbers');
      const totalPages = Math.max(1, Math.ceil(postsData.length / POSTS_PER_PAGE));

      prevButton.disabled = currentPage === 1;
      nextButton.disabled = currentPage === totalPages;

      numbersContainer.innerHTML = '';
      for (let page = 1; page <= totalPages; page += 1) {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = `pagination-number${page === currentPage ? ' current' : ''}`;
        button.textContent = page;
        button.setAttribute('aria-label', `Ir para a página ${page}`);
        button.addEventListener('click', () => {
          currentPage = page;
          renderPosts();
          renderPagination();
          window.scrollTo({ top: document.querySelector('.articles').offsetTop - 80, behavior: 'smooth' });
        });
        numbersContainer.append(button);
      }
    }

    function setupPaginationControls() {
      const pagination = document.querySelector('.pagination');
      if (!pagination) return;
      const prevButton = pagination.querySelector('.prev');
      const nextButton = pagination.querySelector('.next');
      prevButton.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage -= 1;
          renderPosts();
          renderPagination();
          window.scrollTo({ top: document.querySelector('.articles').offsetTop - 80, behavior: 'smooth' });
        }
      });
      nextButton.addEventListener('click', () => {
        const totalPages = Math.max(1, Math.ceil(postsData.length / POSTS_PER_PAGE));
        if (currentPage < totalPages) {
          currentPage += 1;
          renderPosts();
          renderPagination();
          window.scrollTo({ top: document.querySelector('.articles').offsetTop - 80, behavior: 'smooth' });
        }
      });
    }

    async function loadPosts() {
      const listEl = document.querySelector('.post-list');
      if (!listEl) return;

      if (window.location.protocol === 'file:') {
        listEl.innerHTML = '<p class="error-message">Para visualizar os artigos, abre o site através de um servidor local (ex.: <code>python3 -m http.server</code>).</p>';
        document.querySelector('.pagination').classList.add('is-hidden');
        return;
      }

      try {
        const response = await fetch('posts/index.json', { cache: 'no-store' });
        if (!response.ok) throw new Error('Falha ao carregar manifest');
        const posts = await response.json();
        postsData = posts.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
        currentPage = 1;
        renderPosts();
        renderPagination();
      } catch (error) {
        console.error(error);
        listEl.innerHTML = '<p class="error-message">Não foi possível carregar os artigos. Tenta novamente mais tarde.</p>';
        document.querySelector('.pagination').classList.add('is-hidden');
      }
    }

    setupPaginationControls();
    loadPosts();
    });
  </script>
 </body>
</html>
